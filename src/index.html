<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8">
    <title>Bitmark Node User Interface</title>
    <script src="main.js"></script>
    <script src="js/scripts.js"></script>
    <script src="js/jquery-1.7.1.js"></script>
    <link rel="stylesheet" type="text/css" href="css/typography.css">
    <link rel="stylesheet" href="css/styles.css">
  </head>
  <body>
    <div class="title-bar">
      <div class="wc-box-menu">
        <div class="menu" id="menu"><div class="bar" id="menu"></div></div>
      </div>
      <div class="wc-box">
        <div class="minimize" id="min"></div>
        <div class="maximize" id="max"></div>
        <div class="close" id="close"></div>
      </div>
    </div>

    <div class="sidenav">
      <img draggable="false" src="assets/icons/bitmark-logo.svg" class="image-text"/>
      <hr width="65%">
      <a onClick="startBitmarkNodeLocal();" style="cursor: pointer; cursor: hand;">Start Container</a>
      <a onClick="stopBitmarkNodeLocal();" style="cursor: pointer; cursor: hand;">Stop Container</a>
      <a onClick="restartBitmarkNodeLocal();" style="cursor: pointer; cursor: hand;">Restart Container</a>
      <hr width="50%">
      <a onClick="setNetworkBitmarkLocal();" style="cursor: pointer; cursor: hand;">Switch to Bitmark</a>
      <a onClick="setNetworkTestingLocal();" style="cursor: pointer; cursor: hand;">Switch to Testing</a>
      <hr width="50%">
      <a onClick="pullUpdateLocal();" style="cursor: pointer; cursor: hand;">Check for Updates</a>
      <hr width="50%">
      <a onClick="createPreferencesWindowLocal();" style="cursor: pointer; cursor: hand;">Show Preferences</a>
      <a onClick="refreshFrame();" style="cursor: pointer; cursor: hand;">Refresh Window</a>
      <hr width="65%">    
      <a onClick="test();" style="cursor: pointer; cursor: hand;">Refresh Window</a>
      <sub>Bitmark Inc. 2018</sub>
    </div>
    <div id="main" class="main"> 

      <iframe src="http://localhost:9980" class="frame"></iframe>
      <div class="main-text" id="main-text">THE DOCKER CONTAINER IS NOW DOWNLOADING, PLEASE WAIT A MOMENT.</div>
    </div>
  </body>
  <script type="text/javascript">
    window.onload = function() {
      exec("docker inspect bitmark/bitmark-node", (err, stdout, stderr) => {
        //if there is an error, then the image isn't setup
        var out = stdout.toString().trim();
        var err = stderr.toString().trim();

        if(out.indexOf("Error: No such object: bitmark/bitmark-node") !== -1 || err.indexOf("Error: No such object: bitmark/bitmark-node") !== -1 ){
          console.log("Doesn't exist")
          document.getElementById('main-text').style.display = "block"; ;
        }else{
          console.log("Exists");
        }
      });
    };

    //Open all external links in browser - Uses JQuery
    let shell = require('electron').shell
    $('iframe').load(function(){
      $(this).contents().find("body").on('click', function(event) { 
        if (event.target.href.startsWith('https')) {
          event.preventDefault()
          shell.openExternal(event.target.href)
        }
      });
    });
    
  </script>
</html>